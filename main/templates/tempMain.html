{% extends 'base.html' %}
{}

{% block content %}
  <style>
    #hero-outer {
      background-color:#defff2;
    }
    #hero-inner {
      padding-top: 50px;
      padding-bottom: 30px;
    }
    #search-outer {
      background-color: #408558;
    }
    #search-button {
      padding: 20px 10px 20px 10px;
    }
    #search-bg {
      background: linear-gradient(
        to top,
        white 0%,
        white 50%,
        #defff2 50%,
        #defff2 100%
      );
    }
    .book {
      padding: 10px 10px 10px 10px;
    }
    .hide {
      display: none;
    }
    #add-book-judul {
      background: linear-gradient(
        to top,
          #defff2 0%,
          #defff2 50%,
          white 50%,
          white 100%
      );
    }
    #add-book-isi {
      background-color:#defff2;
    }

  </style>

  <header id="hero-outer" class="p-4 rounded-3">
    <div id="hero-inner" class="container">
      <h1 class="display-4 fw-bold"> üìï Bookquet üíê </h1>
      <p class="col-md-8 lead"> Di setiap buku, terdapat karangan kata-kata berbunga! ‚ú® </p>
      <figure>
        <blockquote class="blockquote">
          <p>If you don‚Äôt like to read, you haven‚Äôt found the right book.</p>
        </blockquote>
        <figcaption class="blockquote-footer">
          <cite title="Source Title">J.K. Rowling</cite>
        </figcaption>
      </figure>
    </div>
  </header>

  <div id="search-bg">
    <div id="search-outer" class="container rounded-pill w-75"> 
      <div class="d-flex" style="padding: 10px 10px 10px 10px;">
        <p class="fw-bold p-2 flex-grow-1" style="color: white; margin: auto;"> Cari buku? </p> 
        <a class="btn btn-outline-light" type="button" id="find-button" data-bs-toggle="modal" data-bs-target="#findBookModal"> <i class="bi bi-search"></i> </a>
      </div>
    </div>
  </div>
  <br>

  <h4 class="container d-flex justify-content-center fw-bold"> üìö Daftar Buku üìö </h4>

  <br>
  <div class="container">
    <div class="container">
      <div class="row row-cols-2 row-cols-md-4 g-4" id="buku">
      </div>
    </div>
  </div>

  <br>
  <br>

  {% comment %} Modal untuk merequest buku {% endcomment %}
  <div class="modal fade" id="findBookModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fw-bold" id="modalLabel"> Cari Buku</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="form" method="POST">
                {% csrf_token %}
                <div class="mb-3">
                    <p class="fw-bold"> Judul buku: </p>
                    {{ form.title }}
                </div>
                <div class="mb-3">
                  <p class="fw-bold"> Genre: </p>
                  {{ form.genre.label_tag }}
                  {{ form.genres }}
                </div>
              </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="button_add" data-bs-dismiss="modal"> <i class="bi bi-search"></i> </button>
            </div>
        </div>
    </div>
  </div>

  <script>
    async function getBooks() {
      return fetch("{% url 'main:get_book_json' %}").then((res) => res.json());
    }

    // Fungsi untuk menampilkan buku berdasarkan genre
    async function filterBooksByGenre(genre) {
      document.getElementById("buku").innerHTML = ``;
      const books = await getBooks();
      let htmlString = ``;

      books.forEach((book) => {
        if (genre === 'All' || book.fields.genres.toLowerCase() === genre.toLowerCase()) {
          htmlString +=
          `
          <div class="col"\>
            <div class="card h-100" data-genre="${book.fields.genres}"\>
              <img src= ${book.fields.cover_img} class="card-img-top"\>
              <div class="card-body"\>
                <h5 class="card-title fw-bold"> ${book.fields.title} </h5\>
                <p class="card-text"><small class="text-body-secondary"> ${book.fields.author} </small></p\>
                <p class="card-text"><small class="text-body-success border border-success rounded p-1"> ${book.fields.genres} </small></p\>
              </div\>
              <a href="#" class="stretched-link"></a>
              <div class="card-footer text-muted"> <i class="bi bi-bookmark-plus"></i> Read Later </div>
            </div\>
          </div\>`;
        }
      });
      
      document.getElementById("buku").innerHTML = htmlString;
    }

    filterBooksByGenre("All");
  
    // Fungsi untuk menampilkan buku berdasarkan judul
    async function filterBooksByTitle(title) {
      document.getElementById("buku").innerHTML = ``;
      const books = await getBooks();
      let htmlString = ``;

      books.forEach((book) => {
        if (book.fields.title.toLowerCase().includes(title.toLowerCase())) {
          htmlString +=
          `
          <div class="col"\>
            <div class="card h-100" data-genre="${book.fields.genres}"\>
              <img src= ${book.fields.cover_img} class="card-img-top"\>
              <div class="card-body"\>
                <h5 class="card-title fw-bold"> ${book.fields.title} </h5\>
                <p class="card-text"><small class="text-body-secondary"> ${book.fields.author} </small></p\>
                <p class="card-text"><small class="text-body-success border border-success rounded p-1"> ${book.fields.genres} </small></p\>
              </div\>
            </div\>
          </div\>`;
        }
      });
      
      document.getElementById("buku").innerHTML = htmlString;
    }
  
    // Event listener untuk tombol genre
    // const genreButtons = document.querySelectorAll('.btn-check');
    // genreButtons.forEach((button) => {
    //  button.addEventListener('click', () => {
    //    const selectedGenre = button.value;
    //    filterBooksByGenre(selectedGenre);
    //  });
    // });

    function searchBook() {
      fetch("{% url 'main:find_book' %}", {
        method: "POST",
        body: new FormData(document.querySelector('#form'))
      })

      document.getElementById("form").reset()
      return false
    }

    document.getElementById("button_add").onclick = searchBook

  </script>
{% endblock %}